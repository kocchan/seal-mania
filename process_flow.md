# Yahoo!ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ ãƒ„ã‚¤ãƒ¼ãƒˆåé›†ã‚·ã‚¹ãƒ†ãƒ  å‡¦ç†ãƒ•ãƒ­ãƒ¼è©³ç´°

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ã‚µãƒ³ãƒªã‚ªã®å…¬å¼ã‚°ãƒƒã‚ºï¼ˆãƒœãƒ³ãƒœãƒ³ãƒ‰ãƒ­ãƒƒãƒ—ã€ã·ã£ãã‚Šã‚·ãƒ¼ãƒ«ï¼‰ã®åœ¨åº«æƒ…å ±ã‚’Yahoo!ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ã‹ã‚‰è‡ªå‹•åé›†ã—ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ä¿å­˜ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```mermaid
graph TD
    A[ğŸš€ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•] --> B[ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿]
    
    subgraph "åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚º"
        B --> B1[queries.json<br/>æ¤œç´¢ã‚¯ã‚¨ãƒªèª­ã¿è¾¼ã¿]
        B --> B2[ng_words.json<br/>NGãƒ¯ãƒ¼ãƒ‰è¨­å®šèª­ã¿è¾¼ã¿]
        B --> B3[official_accounts.json<br/>å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§èª­ã¿è¾¼ã¿]
        B --> B4[blacklist.txt<br/>ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿]
        B --> B5[tweets.json<br/>æ—¢å­˜ãƒ„ã‚¤ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿]
    end
    
    B1 --> C
    B2 --> C
    B3 --> C
    B4 --> C
    B5 --> C[ğŸ” ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°é–‹å§‹]
    
    subgraph "ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ•ã‚§ãƒ¼ã‚º"
        C --> C1[Playwrightèµ·å‹•<br/>Chrome headlessãƒ¢ãƒ¼ãƒ‰]
        C1 --> C2[æ¤œç´¢ã‚¯ã‚¨ãƒªã”ã¨ã«ãƒ«ãƒ¼ãƒ—]
        C2 --> C3[Yahoo!æ¤œç´¢URLæ§‹ç¯‰]
        C3 --> C4[ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ & å¾…æ©Ÿ]
        C4 --> C5[DOMè¦ç´ æ¤œç´¢<br/>è¤‡æ•°ã‚»ãƒ¬ã‚¯ã‚¿ã§è©¦è¡Œ]
        C5 --> C6[ãƒ„ã‚¤ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿æŠ½å‡º]
        C6 --> C7{ä»–ã®ã‚¯ã‚¨ãƒªã‚ã‚Šï¼Ÿ}
        C7 -->|Yes| C2
        C7 -->|No| D
    end
    
    D[ğŸ“ å–å¾—ãƒ‡ãƒ¼ã‚¿çµ±åˆ] --> E[ğŸ”„ ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–‹å§‹]
    
    subgraph "ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ•ã‚§ãƒ¼ã‚º"
        E --> F1{å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼Ÿ}
        F1 -->|No| DISCARD1[âŒ ç ´æ£„]
        F1 -->|Yes| F2{ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼Ÿ}
        
        F2 -->|Yes| DISCARD2[âŒ ç ´æ£„]
        F2 -->|No| F3{IDé‡è¤‡ãƒã‚§ãƒƒã‚¯}
        
        F3 -->|é‡è¤‡| DISCARD3[âŒ ç ´æ£„]
        F3 -->|æ–°è¦| F4{ãƒ†ã‚­ã‚¹ãƒˆé‡è¤‡ãƒã‚§ãƒƒã‚¯<br/>å…ˆé ­100æ–‡å­—ã§åˆ¤å®š}
        
        F4 -->|é‡è¤‡| DISCARD4[âŒ ç ´æ£„]
        F4 -->|æ–°è¦| F5{URLå­˜åœ¨ãƒã‚§ãƒƒã‚¯}
        
        F5 -->|URLãªã—| DISCARD5[âŒ ç ´æ£„]
        F5 -->|URLã‚ã‚Š| F6{NGãƒ¯ãƒ¼ãƒ‰/ã‚¹ãƒ‘ãƒ ãƒã‚§ãƒƒã‚¯}
        
        F6 -->|æ¤œçŸ¥| BAN[ğŸš« è‡ªå‹•BANå®Ÿè¡Œ]
        BAN --> BAN1[ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã«è¿½åŠ ]
        BAN1 --> DISCARD6[âŒ ç ´æ£„]
        
        F6 -->|ã‚¯ãƒªãƒ¼ãƒ³| KEEP[âœ… ä¿å­˜å¯¾è±¡ã¨ã—ã¦æ¡ç”¨]
    end
    
    KEEP --> G{ä»–ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚ã‚Šï¼Ÿ}
    DISCARD1 --> G
    DISCARD2 --> G
    DISCARD3 --> G
    DISCARD4 --> G
    DISCARD5 --> G
    DISCARD6 --> G
    
    G -->|Yes| E
    G -->|No| H[ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜å‡¦ç†]
    
    subgraph "ä¿å­˜ãƒ•ã‚§ãƒ¼ã‚º"
        H --> H1[æ–°ãƒ„ã‚¤ãƒ¼ãƒˆ + æ—¢å­˜ãƒ‡ãƒ¼ã‚¿çµåˆ]
        H1 --> H2[æœ€æ–°2000ä»¶ã«åˆ¶é™]
        H2 --> H3[JSONå½¢å¼ã§æ›¸ãè¾¼ã¿]
        H3 --> H4[ğŸ“Š çµæœçµ±è¨ˆè¡¨ç¤º]
    end
    
    H4 --> END[ğŸ å‡¦ç†å®Œäº†]
```

## è©³ç´°å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 1. åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚º (`index.js:9-18`)

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ | ä¾‹ |
|---------|------|-----|
| `queries.json` | æ¤œç´¢ã‚¯ã‚¨ãƒªå®šç¾© | "ãƒœãƒ³ãƒœãƒ³ãƒ‰ãƒ­ãƒƒãƒ—" (åœ¨åº« OR å…¥è·) -PR |
| `ng_words.json` | NGãƒ¯ãƒ¼ãƒ‰/URLè¨­å®š | ãƒ¡ãƒ«ã‚«ãƒªã€amazon.co.jp/dpã€ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ |
| `official_accounts.json` | è¨±å¯ã™ã‚‹å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ | bonbon_drop, sanrio_official |
| `blacklist.txt` | BANã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID | user123\nspammer456 |
| `tweets.json` | éå»ã«ä¿å­˜ã•ã‚ŒãŸãƒ„ã‚¤ãƒ¼ãƒˆ | [{id, text, url, ...}, ...] |

### 2. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ•ã‚§ãƒ¼ã‚º (`scraper.js`)

#### 2.1 ãƒ–ãƒ©ã‚¦ã‚¶åˆæœŸåŒ–
```javascript
// Chrome headlessãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
const browser = await chromium.launch({ headless: true });
// User-Agentè¨­å®šã§botæ¤œçŸ¥å›é¿
userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)...'
```

#### 2.2 æ¤œç´¢å‡¦ç†
- **URLæ§‹ç¯‰**: `https://search.yahoo.co.jp/realtime/search?p=${encodeURIComponent(query)}`
- **ãƒšãƒ¼ã‚¸é·ç§»**: `page.goto(url, { waitUntil: 'domcontentloaded' })`
- **å¾…æ©Ÿæˆ¦ç•¥**: 3ç§’å›ºå®šå¾…æ©Ÿ + DOMè¦ç´ æ¤œç´¢

#### 2.3 DOMè¦ç´ æ¤œç´¢æˆ¦ç•¥
```javascript
const possibleSelectors = [
    'div[class*="Tweet_body"]',    // Yahooæ¤œç´¢çµæœã®ä¸»è¦ã‚»ãƒ¬ã‚¯ã‚¿
    'div[class*="tweet"]',         // æ±ç”¨ãƒ„ã‚¤ãƒ¼ãƒˆã‚»ãƒ¬ã‚¯ã‚¿
    'div[class*="Tweet"]',         // å¤§æ–‡å­—ç‰ˆ
    'article',                     // HTML5 articleè¦ç´ 
    'div[data-testid]',           // ãƒ†ã‚¹ãƒˆç”¨å±æ€§
    '.cnt'                        // Yahooå›ºæœ‰ã‚¯ãƒ©ã‚¹
];
```

#### 2.4 ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºå‡¦ç†
å„ãƒ„ã‚¤ãƒ¼ãƒˆã‹ã‚‰ä»¥ä¸‹ã®æƒ…å ±ã‚’æŠ½å‡ºï¼š
- **åŸºæœ¬æƒ…å ±**: IDã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã€ãƒ†ã‚­ã‚¹ãƒˆã€URL
- **æ™‚é–“æƒ…å ±**: æŠ•ç¨¿æ™‚åˆ»ï¼ˆç›¸å¯¾ãƒ»çµ¶å¯¾ï¼‰
- **ãƒ¡ãƒ‡ã‚£ã‚¢**: ç”»åƒæƒ…å ±ï¼ˆsrcã€altã€ã‚µã‚¤ã‚ºï¼‰
- **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«è¦ç´ **: ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ã€ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³
- **ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ**: ãƒªãƒ—ãƒ©ã‚¤ã€RTã€ã„ã„ã­æ•°

### 3. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ•ã‚§ãƒ¼ã‚º (`index.js:29-73`)

#### 3.1 å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
```javascript
if (!officialAccounts.includes(tweet.userId)) {
    discardedCount++;
    continue; // å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä»¥å¤–ã¯é™¤å¤–
}
```

#### 3.2 ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆãƒã‚§ãƒƒã‚¯
```javascript
if (isBlacklisted(tweet.userId, blacklistSet)) {
    discardedCount++;
    continue; // BANã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é™¤å¤–
}
```

#### 3.3 é‡è¤‡ãƒã‚§ãƒƒã‚¯
- **IDé‡è¤‡**: `savedTweetIds.has(tweet.id)`
- **ãƒ†ã‚­ã‚¹ãƒˆé‡è¤‡**: å…ˆé ­100æ–‡å­—ã®ãƒãƒƒã‚·ãƒ¥ã§åˆ¤å®š

#### 3.4 URLå­˜åœ¨ãƒã‚§ãƒƒã‚¯
```javascript
if (tweet.url === null || (Array.isArray(tweet.urls) && tweet.urls.length === 0)) {
    discardedCount++; // URLãŒãªã„ãƒ„ã‚¤ãƒ¼ãƒˆã¯é™¤å¤–
    continue;
}
```

#### 3.5 NGãƒ¯ãƒ¼ãƒ‰/ã‚¹ãƒ‘ãƒ ãƒã‚§ãƒƒã‚¯ (`filters.js:14-38`)
```javascript
// ãƒ†ã‚­ã‚¹ãƒˆå†…NGãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
for (const ngWord of ngConfig.texts) {
    if (text.includes(ngWord)) {
        executeBan(userId, blacklistSet, `NGãƒ¯ãƒ¼ãƒ‰æ¤œçŸ¥: ${ngWord}`);
        return true;
    }
}

// URLå†…ã‚¹ãƒ‘ãƒ ãƒã‚§ãƒƒã‚¯  
for (const url of urls) {
    for (const ngUrl of ngConfig.urls) {
        if (url.includes(ngUrl)) {
            executeBan(userId, blacklistSet, `ã‚¹ãƒ‘ãƒ URLæ¤œçŸ¥: ${ngUrl}`);
            return true;
        }
    }
}
```

### 4. è‡ªå‹•BANæ©Ÿèƒ½ (`filters.js:41-47`)
```javascript
function executeBan(userId, blacklistSet, reason) {
    if (!blacklistSet.has(userId)) {
        console.log(`ğŸš« [AutoBAN] User: ${userId} Reason: ${reason}`);
        blacklistSet.add(userId);     // ãƒ¡ãƒ¢ãƒªæ›´æ–°
        appendToBlacklist(userId);    // ãƒ•ã‚¡ã‚¤ãƒ«è¿½è¨˜
    }
}
```

### 5. ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ•ã‚§ãƒ¼ã‚º (`index.js:78-89`)
```javascript
// æ–°ã—ã„ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®å…ˆé ­ã«è¿½åŠ 
const updatedTweets = [...newTweets, ...savedTweets];

// æœ€æ–°2000ä»¶ã®ã¿ä¿æŒï¼ˆå¤ã„ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•å‰Šé™¤ï¼‰
const MAX_SAVE = 2000;
const trimmedTweets = updatedTweets.slice(0, MAX_SAVE);

// JSONå½¢å¼ã§ä¿å­˜
saveTweets(trimmedTweets);
```

## è¨­å®šè©³ç´°

### NGãƒ¯ãƒ¼ãƒ‰è¨­å®šä¾‹
```json
{
  "texts": [
    "ãƒ¡ãƒ«ã‚«ãƒª", "è»¢å£²", "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ", "æ‹›å¾…ã‚³ãƒ¼ãƒ‰",
    "ç›¸äº’ãƒ•ã‚©ãƒ­ãƒ¼", "ãƒã‚¤æ´»", "è²·å–", "ãƒ•ãƒªãƒ"
  ],
  "urls": [
    "mercari.com", "amazon.co.jp/dp", "rakuten",
    "bit.ly", "tinyurl", "amzn", "r10.to"
  ]
}
```

### æ¤œç´¢ã‚¯ã‚¨ãƒªä¾‹
```json
[
  "\"ãƒœãƒ³ãƒœãƒ³ãƒ‰ãƒ­ãƒƒãƒ—\" (\"å…¥è·\" OR \"åœ¨åº«\" OR \"å£²ã£ã¦ãŸ\" OR \"è²·ãˆãŸ\") -PR -AD -Amazon -æ¥½å¤© -ãƒ¡ãƒ«ã‚«ãƒª",
  "\"ã·ã£ãã‚Šã€€ã‚·ãƒ¼ãƒ«\" (\"å…¥è·\" OR \"åœ¨åº«\" OR \"å£²ã£ã¦ãŸ\" OR \"è²·ãˆãŸ\") -PR -AD -Amazon -æ¥½å¤© -ãƒ¡ãƒ«ã‚«ãƒª"
]
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ

å®Ÿè¡Œå¾Œã«ä»¥ä¸‹ã®çµ±è¨ˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š
```
ğŸ“Š Result: Scraped=45, New=8, Discarded=37, AutoBan=3
ğŸ’¾ Saved 1834 tweets to data/tweets.json
```

- **Scraped**: ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã§å–å¾—ã—ãŸç·ãƒ„ã‚¤ãƒ¼ãƒˆæ•°
- **New**: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œã«æ–°è¦ä¿å­˜ã•ã‚ŒãŸãƒ„ã‚¤ãƒ¼ãƒˆæ•°  
- **Discarded**: å„ç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§é™¤å¤–ã•ã‚ŒãŸãƒ„ã‚¤ãƒ¼ãƒˆæ•°
- **AutoBan**: ã‚¹ãƒ‘ãƒ æ¤œçŸ¥ã«ã‚ˆã‚Šè‡ªå‹•BANã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

1. **Rate Limiting**: æ¤œç´¢é–“ã«1ç§’é–“éš”ã‚’è¨­å®š
2. **User-Agentå½è£…**: botæ¤œçŸ¥å›é¿
3. **Headlessãƒ¢ãƒ¼ãƒ‰**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ
4. **è‡ªå‹•BAN**: ã‚¹ãƒ‘ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªå‹•æ’é™¤
5. **ãƒ‡ãƒ¼ã‚¿åˆ¶é™**: æœ€å¤§2000ä»¶ã§å®¹é‡åˆ¶å¾¡